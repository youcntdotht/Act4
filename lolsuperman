# PROGRAMA DE CONSUMO DE REFRESCOS, CON BASE EN LA ENCUESTA REALIZADA EN LA ACTIVIDAD 1
library(readxl)
library(dplyr)
library(DescTools)
library(tidyr)

# Cargar datos
ml.dia <- read_excel(
  "C:/Users/alfre/Downloads/ESTUDIO SOBRE EL CONSUMO DE LOS REFRESCOS _)(1-121).xlsx",
  sheet = "Hoja1",
  range = "A1:K11",
  col_names = FALSE
)

# Función para obtener la moda
primer_modo <- function(x, na.rm = FALSE) { 
  if (na.rm) x <- na.omit(x)
  if (length(x) == 0) return(NA)
  modo <- DescTools::Mode(x, na.rm = na.rm)
  return(modo[1])
}

# Unificar todos los valores en una sola columna
columna <- unlist(ml.dia)

# CANTIDAD DE DATOS TOTALES
t <- length(columna)
cat("Datos totales:", t, "\n")

# Medidas estadísticas
media <- mean(columna, na.rm = TRUE)
vari <- var(columna, na.rm = TRUE)
d.e <- sd(columna, na.rm = TRUE)
moda <- primer_modo(columna, na.rm = TRUE)

cat("Media:", media, "\n")
cat("Varianza:", vari, "\n")
cat("Desviación estándar:", d.e, "\n")
cat("Moda:", moda, "\n")

# PROBABILIDAD DE QUE X SEA MAYOR A 750 ML
probabilidad_mayor_750 <- 1 - pnorm(750, media, d.e)
cat("P(X > 750) =", round(probabilidad_mayor_750, 4), "\n")

# INTERVALO DE CONFIANZA DEL 90%
alpha <- 0.10
z <- qnorm(1 - alpha/2)
margen_De_error <- z * (d.e / sqrt(t))
limite_inf <- media - margen_De_error
limite_sup <- media + margen_De_error

cat("Intervalo de confianza del 90% para el consumo promedio de refrescos:\n")
cat("[", round(limite_inf, 3), ",", round(limite_sup, 3), "]\n")

# GRÁFICA DE DISTRIBUCIÓN NORMAL
x <- seq(min(columna), max(columna), 0.1)
y <- dnorm(x, mean = media, sd = d.e)

plot(x, y, type = "l", lwd = 2, col = "red",
     main = "Distribución normal del consumo de refrescos",
     xlab = "Mililitros consumidos por día", 
     ylab = "Densidad de probabilidad")

x_sombreado <- seq(200, 750, 0.1)

y_sombreado <- dnorm(x_sombreado, mean = media, sd = d.e)

polygon(c(x_sombreado, 750), c(y_sombreado, 0), col = "grey")


text(media, max(y)*0.9, paste("Media =", round(media, 2)), col = "brown", pos = 4)
text(750, max(y)*0.4, "Área = P(X < 750)", col = "blue")

# TABLA Y GRÁFICAS
consumo_refrescos <- table(columna)
print(consumo_refrescos)

# GRÁFICO DE BARRAS
barplot(consumo_refrescos,
        main = "Consumo de refrescos por cantidad (ml)",
        xlab = "Mililitros por día",
        ylab = "Número de personas",
        col = c("skyblue", "orange", "lightgreen", "pink"),
        ylim = c(0, max(consumo_refrescos) + 5))

# GRÁFICA DE PIE
labels <- paste(names(consumo_refrescos), "ml (", 
                round(consumo_refrescos/sum(consumo_refrescos)*100, 1), "%)")

pie(consumo_refrescos, labels = labels,
    main = "Distribución del consumo de refrescos",
    col = rainbow(length(consumo_refrescos)))
